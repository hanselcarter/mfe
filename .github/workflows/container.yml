name: Continuous Integration

on:
    pull_request:
        branches: [master, develop]
        paths-ignore:
            - "README.md"

jobs:
    lint:
        runs-on: ubuntu-22.04
        name: Lint
        steps:
            - name: Checkout
              uses: actions/checkout@v3

            - name: Setup node
              uses: actions/setup-node@v3
              with:
                  node-version: lts/gallium

            - name: Set up scoped registries
              run: |
                  npm config set @fortawesome:registry=https://npm.fontawesome.com/
                  npm config set //npm.fontawesome.com/:_authToken ${FONTAWESOME_TOKEN}
                  npm config set @partnerhero:registry=https://npm.pkg.github.com
                  npm config set //npm.pkg.github.com/:_authToken=${GH_TOKEN_CLASSIC}
              env:
                  FONTAWESOME_TOKEN: ${{ secrets.FONTAWESOME_TOKEN }}
                  BIT_TOKEN: ${{ secrets.BIT_TOKEN }}
                  GH_TOKEN_CLASSIC: ${{ secrets.GH_TOKEN_CLASSIC }}

            - name: Install dependencies
              run: yarn ci

            - name: Lint
              run: yarn lint
    build:
        runs-on: ubuntu-22.04
        name: Build
        steps:
            - name: Checkout
              uses: actions/checkout@v3

            - name: Setup node
              uses: actions/setup-node@v3
              with:
                  node-version: lts/gallium

            - name: Set up scoped registries
              run: |
                  npm config set @fortawesome:registry=https://npm.fontawesome.com/
                  npm config set //npm.fontawesome.com/:_authToken ${FONTAWESOME_TOKEN}
                  npm config set @partnerhero:registry=https://npm.pkg.github.com
                  npm config set //npm.pkg.github.com/:_authToken=${GH_TOKEN_CLASSIC}
              env:
                  FONTAWESOME_TOKEN: ${{ secrets.FONTAWESOME_TOKEN }}
                  BIT_TOKEN: ${{ secrets.BIT_TOKEN }}
                  GH_TOKEN_CLASSIC: ${{ secrets.GH_TOKEN_CLASSIC }}

            - name: Install dependencies
              run: yarn ci

            - name: Build bundle
              run: yarn build
    test:
        runs-on: ubuntu-22.04
        name: test
        steps:
            - name: Checkout
              uses: actions/checkout@v3

            - name: Setup node
              uses: actions/setup-node@v3
              with:
                  node-version: lts/gallium

            - name: Set up scoped registries
              run: |
                  npm config set @fortawesome:registry=https://npm.fontawesome.com/
                  npm config set //npm.fontawesome.com/:_authToken ${FONTAWESOME_TOKEN}
                  npm config set @partnerhero:registry=https://npm.pkg.github.com
                  npm config set //npm.pkg.github.com/:_authToken=${GH_TOKEN_CLASSIC}
              env:
                  FONTAWESOME_TOKEN: ${{ secrets.FONTAWESOME_TOKEN }}
                  BIT_TOKEN: ${{ secrets.BIT_TOKEN }}
                  GH_TOKEN_CLASSIC: ${{ secrets.GH_TOKEN_CLASSIC }}

            - name: Install dependencies
              run: yarn ci

            - name: Test
              run: yarn test:cov
